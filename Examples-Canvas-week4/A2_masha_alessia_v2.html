<!-- ASSIGNMENT 2 BY MASHA KROTKYKH & ALESSIA SIGNORINO -->

<!DOCTYPE html>
<html>
<head>
  <title> ASSIGNMENT 2 </title>
  <style>
  body{
    margin:0;
    padding:0;
  }
  canvas{
    background:#ffdfba;
}
  </style>

  <script>

  //run once window loads
  window.onload = function(){

//Get the canvas and contexts (2D and sound)
let canvas = document.getElementById("testCanvas");
let context = canvas.getContext("2d");
let audioContext = new (window.AudioContext || window.webkitAudioContext)();

//Empty array of square shapes
let shapeList = [];
const NUM_SHAPES = 50;
let colors = ["#808080","#A9A9A9","#C0C0C0","#DCDCDC"];

//Pushing diff squares in shapeList array
for(let i=0; i<NUM_SHAPES; i++){
  let r = 0;
  let g = 0;
  let rSpeed = 2;
  let size = Math.floor((Math.random()*100)+20);
  let x = Math.floor((Math.random()*canvas.width));
  let y = Math.floor((Math.random()*canvas.height));

  shapeList.push(new CustomShape(x,y,size,size,r,g,b,a,i));
}

//Event listener of canvas, for as many shapes there are
canvas.addEventListener("mouseover",function(event){
  for(let i = 0;i<NUM_SHAPES;i++){
    shapeList[i].mouseOver(event);
  }
});

//Event listener for mouse down
canvas.addEventListener("mousedown",function(event){
  console.log("canvas mouse clicked");
  for(let i=0; i<NUM_SHAPES; i++){
    shapeList[i].hitTest(event);
  }
});

//Recursive requestAnimationFrame
requestAnimationFrame(runAni);

function runAni(){
  canvasContext.clearRect(0,0,canvas.width,canvas.height);

  for(let i=0;i<shapeList.length;i++){
    shapeList[i].update();
    shapeList[i].render();
  }
  requestAnimationFrame(runAni);
}

//CustomShape Class
    function CustomShape(x,y,size,size,r,g,b,a,eid,rSpeed){

      //Constructor
      this.x = x;
      this.y = y;
		  this.size = size;
      this.r = r;
      this.g = g;
      this.b = b;
      this.a = a;
      this.innerH = this.size/2;
      this.innerW = this.size/2;
      this.eID = eid;
      this.rSpeed = 0;
      this.maxrSpeed = .2;

      this.cChange = 10;
      this.cFade = 1;
      this.theta = 0;

      this.isOver = false;
      this.isPressed = false;

      // Color each instance
		  this.col = "rgba("+this.r+","+this.g+","+this.b+","+this.a+")";
          context.fillStyle = this.col;

      this.render = function(){ // WORKING ON THIS **************

        // Rotation
        context.save();
        context.translate(this.x, this.y);
        context.rotate(this.theta);
    		this.theta += this.rSpeed;

        context.fillRect(-this.size/2, -this.size/2, this.size, this.size);
        context.clearRect(-this.size/2+this.innerW/2, -this.size/2+this.innerH/2, this.innerW, this.innerH);
        context.restore();

        this.innerX = this.x + this.innerW/2;
        this.innerY = this.y + this.innerH/2;

      }

    // move only when mouse is over
    this.update = function(){
      if(this.isOver ===true){
      if(this.xPos<0 || this.xPos>canvas.width){
        this.xSpeed*=-1;
      }
      if(this.yPos<0 || this.yPos>canvas.height){
        this.ySpeed*=-1;
      }
      this.xPos+=this.xSpeed;
      this.yPos+=this.ySpeed;
      }
    }

    // Callback function: check if a square, if yes, make Sound (DEFINE SOUND FREQ BELOW BY Y.POS)**
    this.handleHover = function (event) {
      if(Math.sqrt(Math.pow((event.clientX-this.x),2)+Math.pow((event.clientY-this.y),2))<this.w/2){
        // console.log("Rect Over::: "+this.eID);
        console.log("Over a rectangle - ID: "+this.id);
        this.isOver = !this.isOver;
      }

      // Sound will happen if mouse is over
      if(this.isOver === true){
        let now = audioContext.currentTime;
        this.note.offsetDuration = 2;
        this.freqVal = this.freqVal+(this.ySpeed*2);
        this.note.play(this.freqVal, now);
      }
    } // end handleHover

  } // end CustomShape class

  /*** class for sound inspired and copy-lefted from::
  https://css-tricks.com/introduction-web-audio-api/*/
  function Sound (context) {
  this.context = context;
  this.offsetDuration =0;

  this.init =function () {
    this.oscillator = this.context.createOscillator();
    //for volume
    this.gainNode = this.context.createGain();

    this.oscillator.connect(this.gainNode);
    this.gainNode.connect(this.context.destination);
    this.oscillator.type = 'sine';
  }

  this.play = function (value, time) {
    this.init();

    this.oscillator.frequency.value = value;
    //set gain
    this.gainNode.gain.setValueAtTime(1, this.context.currentTime);

    this.oscillator.start(time);
    // How LONG should duration of note be?
    this.stop(time+this.offsetDuration);

  }

  this.stop = function(time) {
    // gradual change in value
    this.gainNode.gain.exponentialRampToValueAtTime(0.001, time + 1);
    this.oscillator.stop(time + 0);
    }
  }   //end Sound object

} //end of window load
  </script>
</head>
<body>
  <canvas id = "testCanvas" width = 800 height =600></canvas>
</body>
</html>
